## istio 설치

 #### Download Istio

```
$ curl -L https://istio.io/downloadIstio | sh -

$ cd istio-1.15.0
$ export PATH=$PWD/bin:$PATH 
$ echo "export PATH=$PWD/bin:$PATH" >> ~/.bashrc
$ source ~/.bashrc
$ istioctl
Istio configuration command line utility for service operators to
debug and diagnose their Istio mesh.

Usage:
  istioctl [command]

Available Commands:
  admin                Manage control plane (istiod) configuration
  analyze              Analyze Istio configuration and print validation messages
  authz                (authz is experimental. Use `istioctl experimental authz`)
  bug-report           Cluster information and log capture support tool.
  ~~~~~~~~~~~~~~~~~

```
##### 특정 버전 설치 시
```
$ curl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.15.0 TARGET_ARCH=x86_64 sh -
```

#### Deploy the Istio operator
```
$ istioctl operator init
Operator controller is already installed in istio-operator namespace.
Upgrading operator controller in namespace: istio-operator using image: docker.io/istio/operator:1.15.0
Operator controller will watch namespaces: istio-system
✔ Istio operator installed
✔ Installation complete
```

#### Install Istio with the operator
 operator용 istio-operator.yaml 파일 작성, profile은 default, nlb 사용
 
 ```yml
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
metadata:
  namespace: istio-system
  name: skims-istiocontrolplane
spec:
  profile: default
  components:
    ingressGateways:
    - name: istio-ingressgateway
      label:
        istio: ingressgateway
      k8s:
        serviceAnnotations:
          service.beta.kubernetes.io/aws-load-balancer-type: "nlb"      
 ```
 
 yaml파일 실행
```bash
$ kubectl apply -f istio-operator.yaml

$ kubectl get all -n istio-system
NAME                                        READY   STATUS    RESTARTS   AGE
pod/istio-ingressgateway-55fb44f8f8-gjjsg   1/1     Running   0          2d19h
pod/istiod-d97cbc5f-66jl8                   1/1     Running   0          2d19h

NAME                           TYPE           CLUSTER-IP       EXTERNAL-IP                                                                          PORT(S)                                      AGE
service/istio-ingressgateway   LoadBalancer   172.20.32.221    aaee64fcce8e94922830fc88763eab0f-c0cad1c75d3ef758.elb.ap-northeast-2.amazonaws.com   15021:30280/TCP,80:31095/TCP,443:30159/TCP   2d19h
service/istiod                 ClusterIP      172.20.208.146   <none>                                                                               15010/TCP,15012/TCP,443/TCP,15014/TCP        2d19h

NAME                                   READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/istio-ingressgateway   1/1     1            1           2d19h
deployment.apps/istiod                 1/1     1            1           2d19h

NAME                                              DESIRED   CURRENT   READY   AGE
replicaset.apps/istio-ingressgateway-55fb44f8f8   1         1         1       2d19h
replicaset.apps/istiod-d97cbc5f                   1         1         1       2d19h

NAME                                                       REFERENCE                         TARGETS   MINPODS   MAXPODS   REPLICAS   AGE
horizontalpodautoscaler.autoscaling/istio-ingressgateway   Deployment/istio-ingressgateway   2%/80%    1         5         1          2d19h
horizontalpodautoscaler.autoscaling/istiod                 Deployment/istiod                 0%/80%    1         5         1          2d19h


```


#### 사이드카 인젝션

namespace 라벨에 적용

```bash
$ kubectl label namespaces default istio-injection=enable --
namespace/default labeled
```

**istio-injection=enable** 확인
```
$ kubectl get namespaces --show-labels
NAME              STATUS   AGE     LABELS
default           Active   19d     istio-injection=enable,kubernetes.io/metadata.name=default
istio-operator    Active   2d12h   kubernetes.io/metadata.name=istio-operator
istio-system      Active   2d12h   kubernetes.io/metadata.name=istio-system
kube-node-lease   Active   19d     kubernetes.io/metadata.name=kube-node-lease
kube-public       Active   19d     kubernetes.io/metadata.name=kube-public
kube-system       Active   19d     kubernetes.io/metadata.name=kube-system
skims-core        Active   5d17h   kubernetes.io/metadata.name=skims-core
```


#### g

